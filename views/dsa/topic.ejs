<%- include('../partials/header') %>
<%- include('../partials/navbar') %>

<div class="container mt-4">
    <h2><%= topic.name %> Problems</h2>
    <ul class="list-group">
        <% problems.forEach(problem => { %>
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                    <h5><%= problem.name %></h5>
                    <span class="badge bg-<%= problem.difficulty === 'Easy' ? 'success' : problem.difficulty === 'Medium' ? 'warning' : 'danger' %>">
                        <%= problem.difficulty %>
                    </span>
                </div>
                <div>
                    <a href="<%= problem.leetcodeLink %>" target="_blank" class="btn btn-primary btn-sm">Solve</a>
                    <button class="btn btn-success btn-sm complete-button" data-id="<%= problem._id %>">Completed</button>
                </div>
            </li>
        <% }); %>
    </ul>
</div>

<script>
document.querySelectorAll('.complete-button').forEach(button => {
    button.addEventListener('click', async function() {
        const problemId = this.dataset.id;
        try {
            const response = await fetch(`/admin/problems/${problemId}`, {
                method: 'PATCH', // Assuming you have a PATCH route to update the problem
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ solved: true }) // Mark as solved
            });

            if (response.ok) {
                alert('Problem marked as completed!');
                window.location.reload(); // Reload the page to see the updated list
            } else {
                const data = await response.json();
                alert(data.error || 'Error marking problem as completed');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Error marking problem as completed');
        }
    });
});
</script>

<%- include('../partials/footer') %> 